---
title: "[Study] 2025-1 ì‹œìŠ¤í…œ ë° ì†Œí”„íŠ¸ì›¨ì–´ ë³´ì•ˆ ì¤‘ê°„ê³µë¶€(1)"
categories: [Study, Security]
tags: [study, attack]
date: 2025-04-21 16:13:27 +0900
comments: false
excerpt: "2.Software Security / 3.Spatial Memory Safety / 4.Temporal Memory Safety"
--- 
---

> **Midterm Points**

1. Cia, thrat model, vuln description [1]
2. Red zone technique to defense buffer overflow and limitations (2) [3]
3. Use after free defense technique (5) [4]


> **Temporalê³¼ Spatialì˜ ì°¨ì´ì **

êµ¬ë¶„ | **Spatial Memory Bug** | **Temporal Memory Bug**
ì˜ë¯¸ | ì˜ëª»ëœ **ì£¼ì†Œ(ìœ„ì¹˜)**ì— ì ‘ê·¼ | ì˜ëª»ëœ **ì‹œê°„(ì‹œì )**ì— ì ‘ê·¼
ì˜ˆì‹œ | ë°°ì—´ ê²½ê³„ë¥¼ ë²—ì–´ë‚˜ ì ‘ê·¼ | í•´ì œëœ í¬ì¸í„°ë¥¼ ë‹¤ì‹œ ì‚¬ìš©
í•µì‹¬ ì›ì¸ | ë©”ëª¨ë¦¬ì˜ ì–´ë””ì— ì ‘ê·¼í–ˆëŠ”ê°€ê°€ ì˜ëª»ë¨ | ë©”ëª¨ë¦¬ì˜ ì–¸ì œì— ì ‘ê·¼í–ˆëŠ”ê°€ê°€ ì˜ëª»ë¨
ëŒ€í‘œ ê³µê²© | ë²„í¼ ì˜¤ë²„í”Œë¡œìš°, Out-of-Bounds Read/Write | Use-after-Free, Dangling Pointer

---------------------------------------------------

## 1ì£¼ì°¨: Computer Security

- **ì»´í“¨í„° ë³´ì•ˆ(Computer Security)ì´ë€?**
	- The protection of the assets of a computer system
- **ìš©ì–´ì •ì˜(Threat, Vulnerability, Countermeasure=Control)**
	- **threat**: ìœ„í—˜(harm)ì„ ìœ ë°œí•  ìˆ˜ ìˆëŠ” ìƒí™© = systemì˜ weaknessë¥¼ exploití•˜ëŠ” ê²ƒ?
	- **vulnerabilities**: ìœ„í—˜ì„ exploití•  ìˆ˜ ìˆëŠ” weakness = weakness in system
	- **controls(countermeasures)**: vulnerabilityë¥¼ ì¤„ì´ê±°ë‚˜ ì œê±°í•  ìˆ˜ ìˆëŠ” action, procedure, technique ë“± 
		= protect weakness from exploitation
- **Security Property(ë³´ì•ˆ 3ëŒ€ ìš”ì†Œ)**
	= C-I-A triad(íŠ¸ë¼ì´ì–´ë“œ) = ê¸°ë°€ì„±(Confidentiality), ë¬´ê²°ì„±(Integrity), ê°€ìš©ì„±(Availability)
	- Confidentiality, Integrity, Availability are the three basic security primitives. -> protect í•´ì•¼ í•˜ëŠ” ê²ƒ
- **Access control = who+what+howì— ëŒ€í•œ policy**
	- Different attackers pose different kinds of threats based on their capabilities and motivations.
	- Different controls address different threats; controls come in many flavors and can exist 
		at various points in the system.


---------------------------------------------------

## 2ì£¼ì°¨: Software Security




### Software Execution Model
- A simplified life of a process


### ì†Œí”„íŠ¸ì›¨ì–´ê³µê²©ê³¼ì •


### Threat Categorises
- Code Corruption Attack
- Code Injection Attack
- Code Reuse Attack
- Data Only Attack
- Information Leak Attack

### Overview of Attack & Defense Mechanisms


### Example: Stack Buffer Overflow vuln



---------------------------------------------------

## 3ì£¼ì°¨: Spatial Memory Safety


### Spatial Memory Vulnerability

- Spatial ë©”ëª¨ë¦¬ ì·¨ì•½ì  = buffer overflow, boundaryë¥¼ ë„˜ì–´ê°€ëŠ”,  heap ë“±ì—ì„œ

> â—† ë©”ëª¨ë¦¬ì˜ **ì£¼ì†Œ ê³µê°„(Spatial domain)**ì„ ë¶€ì ì ˆí•˜ê²Œ ë‹¤ë£¨ê±°ë‚˜ ê²€ì¦í•˜ì§€ ì•Šì•„ ë°œìƒí•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì   
> = ì›ë˜ ì¨ì•¼ í•  ë©”ëª¨ë¦¬ ì˜ì—­ì´ ì•„ë‹Œ, ì˜†ìë¦¬ ë©”ëª¨ë¦¬ê¹Œì§€ ì¹¨ë²”í•´ì„œ ë­”ê°€ë¥¼ ì½ê±°ë‚˜ ë®ì–´ì“°ê¸°í•˜ëŠ” ìƒí™©

### Spatial Memory Safety

1. **RedZone**: object ì˜†, boundary ì´í›„ì— RedZone ë‘ê¸°
    - RedZoneì„ ì–´ë–»ê²Œ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬í˜„í•  ê²ƒì¸ê°€?
        - **Memory Paging**
        - **Shadow Memory**
        - **Poisoned Value**
2. **Bounds Checking**: ë©”ëª¨ë¦¬ í• ë‹¹ì‹œì— ì•Œê²Œë˜ëŠ” ì ë²•í•œ boundary ì£¼ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ptr ìœ íš¨ì„± ì²´í¬
    - Bound ì •ë³´ë¥¼ ì–´ë–»ê²Œ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ì‚¬ìš©í•  ê²ƒì¸ê°€?
        - **Fat pointers**
        - Disjoint Metadata

### RedZone (1) Memory Paging

- í˜ì´ì§•ì„ ì‚¬ìš©í•´ì„œ ë ˆë“œì¡´ êµ¬í˜„í•˜ê¸° (*ë§¤ìš° ì˜¤ë˜ëœ ê¸°ë²•)
    - 4KB í˜ì´ì§€ì— object(buffer) í•˜ë‚˜ë§Œ í• ë‹¹í•˜ê³ , ì–‘ì˜†ì—ëŠ” Guard Pageë¥¼ ë‘¬ì„œ ì ‘ê·¼í•˜ë©´ faultê°€ ë‚˜ë„ë¡ í•¨
        - **`MMU`ì— ì˜ì¡´í•˜ëŠ” ë°©ë²•ì„ (~HW ê¸°ë°˜ì˜ ë°©ë²• = Hardware-assisted)**
            - objectë§ˆë‹¤ page table entry í•˜ë‚˜ë¥¼ í• ë‹¹í•´ì£¼ëŠ” ê²ƒ
            > **â—† MMUë¡œ ì–´ë–»ê²Œ êµ¬í˜„í–ˆëŠ”ê°€?** Objectë§ˆë‹¤ ê³ ìœ í•œ í˜ì´ì§€ë¥¼ í• ë‹¹í•˜ê³ , ê·¸ ì£¼ë³€ì„ guard page (redzone)ë¡œ ë³´í˜¸í•œ ë‹¤ìŒ, **MMUì˜ í˜ì´ì§€ ì ‘ê·¼ ê¶Œí•œ**ê³¼ **í˜ì´ì§€ í´íŠ¸(Page Fault) ê¸°ëŠ¥**ì„ ì´ìš©í•´ ê²½ê³„ ì¹¨ë²” ì‹œ ë°”ë¡œ trapì´ ë°œìƒí•˜ë„ë¡ í•˜ëŠ” êµ¬ì¡°
            >> MMU(Memory Management Unit)ëŠ” ê°€ìƒ ì£¼ì†Œ â†’ ë¬¼ë¦¬ ì£¼ì†Œ ë³€í™˜ì„ ë‹´ë‹¹í•˜ê³ , ì´ ê³¼ì •ì—ì„œ í˜ì´ì§€ ë‹¨ìœ„(page-level)ë¡œ ì ‘ê·¼ ê¶Œí•œ(R/W/E)ì„ ì œì–´í•˜ì—¬ page faultë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŒ

    - ë¬´ì¹œ ë©”ëª¨ë¦¬ overhead & cache miss
        - í•˜ì§€ë§Œ ì‚¬ì‹¤ Guard Pageë¥¼ ìœ„í•œ ë¬¼ë¦¬ ë©”ëª¨ë¦¬ëŠ” 4KB í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ë©´ ë¨
        - **Archipelago [ASPLOS '08]**: ë©”ëª¨ë¦¬ ì˜¤ë¥˜ë¥¼ í•˜ë“œì›¨ì–´ í˜ì´ì§€ ë³´í˜¸ ê¸°ëŠ¥ì„ ì´ìš©í•´ íš¨ê³¼ì ìœ¼ë¡œ ë§‰ëŠ” êµ¬ì¡°ë¥¼ ì œì•ˆ
          > **â—† Hot/Cold Object ë¶„ë¦¬ + selective protection**: í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¤‘ ìì£¼ ì ‘ê·¼ë˜ëŠ” hot objectì—ë§Œ ê°ì²´ì˜ ì•ë’¤ì— ì ‘ê·¼ ê¸ˆì§€ëœ guard pageë¥¼ ë„£ëŠ” Electric fence ê¸°ë²• ì‚¬ìš©. ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ì—ì„œ Archipelagoë¥¼ ì ìš©í•´ë„, ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œëŠ” 20% ë¯¸ë§Œìœ¼ë¡œ ë¹„êµì  ì–‘í˜¸í•˜ì§€ë§Œ, malloc-heavy í”„ë¡œê·¸ë¨ì˜ ê²½ìš°ëŠ” ìµœëŒ€ 5ë°° ì´ìƒ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ


### RedZone (2) Shadow Memory

- ì‚¬ìš©ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ì˜ word(4, 8byte)ë§ˆë‹¤ì˜ ìƒíƒœë¥¼ ê¸°ë¡í•˜ëŠ” shadow ë©”ëª¨ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ redzone í‘œì‹œ (~SW ê¸°ë°˜ì˜ ë°©ë²•)
- **Address Sanitizer [ATCâ€™12]**
    - 4KB í˜ì´ì§€ ë‹¨ìœ„ê°€ ì•„ë‹Œ, 16byte ì •ë„ì˜ ì‘ì€ redzoneì„ ë‘˜ ìˆ˜ ìˆìŒ
    - ëª¨ë“  ë©”ëª¨ë¦¬ ì—°ì‚° ì•ì— ì¶”ê°€ì ì¸ instructionì´ ë“¤ì–´ê° (â—† ì–´ì…ˆë¸”ë¦¬ ì½”ë“œ ì²´í¬í•˜ê¸°)
        - ì²«ì¤„: 8byte ë©”ëª¨ë¦¬ë‹¹ 1byteì˜ shadow ë©”ëª¨ë¦¬ë¥¼ ì¤€ë‹¤
        ![ASan instuction](\assets\img\paper\ASan instuction.PNG)
        _shadow memory ê¸°ë°˜ì˜ ë©”ëª¨ë¦¬ ì ‘ê·¼ ê²€ì¦ ë£¨í‹´_
    - ë‹¨ì : redzoneì„ ìœ„í•œ shadow ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•´ì¤˜ì•¼ í•¨

### RedZone (3) Poisoned Value
- **store a special value in the redzone area (~SW ê¸°ë°˜ì˜ ë°©ë²•)**
    - ë©”ëª¨ë¦¬ ì—°ì‚°ë§ˆë‹¤ ASan ê°™ì€ ì²´í¬ ì—°ì‚°ì„ ë‘ì§€ ì•Šê³ , ì ‘ê·¼í• ë ¤ëŠ” ì£¼ì†Œì˜ ë©”ëª¨ë¦¬ë¥¼ ë¨¼ì € ì½ì–´ë´„.  
    â” special valueê°€ ìˆìœ¼ë©´ RedZoneì´ë¼ê³  íŒë‹¨
    - shadow ë©”ëª¨ë¦¬ë¥¼ ì•ˆì¨ë„ ë¨ â†’ ASanë³´ë‹¤ëŠ” ë©”ëª¨ë¦¬ íš¨ìœ¨ì 
        - ë‹¨ì : special valueê°€ ìœ ì¶œë˜ë©´ ì‰½ê²Œ ìš°íšŒ ê°€ëŠ¥
    - Stack Canaryê°€ Poisoned Value ë°©ì‹ì„


- **LBC [CGOâ€™12]**
    - Poisoned Valueë¥¼ Heapì— ì ìš©í•œ ê²ƒ
    - **êµ¬í˜„ì‹œì˜ ë¬¸ì œì : False Detection Problem** â” special valueê°€ í”„ë¡œê·¸ë¨ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê°’ê³¼ ìš°ì—°íˆ ì¼ì¹˜í•  ìˆ˜ ìˆìŒ
    - Solution â” hybrid approach (shadow memory based `Slow check`)
        -  Use a bitmap to represent the state of each byte in data memory for verification
            > â—† LBCì—ì„œëŠ” shadow memoryë¥¼ bitmap í˜•ì‹ìœ¼ë¡œ êµ¬í˜„

=================================================================================================

**â€» Red zone: properties**
- (Inevitably has false negatives) ê²°êµ­ RedZone í¬ê¸°ì— ë¹„ë¡€í•˜ëŠ” íƒì§€ ì„±ëŠ¥ì„ ê°–ê²Œ ëœë‹¤ â” RedZoneì„ ìœ„í•œ ë©”ëª¨ë¦¬ ë‚­ë¹„
- Software-only ë°©ì‹ì˜ ê²½ìš°ëŠ” ë©”ëª¨ë¦¬ ì—°ì‚°ë§ˆë‹¤ ì¶”ê°€ instructionì„ ë„£ì–´ì¤˜ì•¼ í•¨ â” performace ë¬¸ì œ
- Hardware-assisted ë°©ì‹ì€ ê²°êµ­ cache ì„±ëŠ¥ì´ ì €í•˜ë˜ê³ , page table ì—°ì‚°ì´ ë§ì•„ì§€ê²Œ ë¨

=================================================================================================


### Bounds Checking (1) Fat pointers

- ê²°êµ­ pointerì˜ ë¬¸ì œì´ë¯€ë¡œ, pointerê°€ ì ‘ê·¼í•˜ëŠ” ì˜ì—­ì— ëŒ€í•œ metadataë¥¼ ë‘ì.
    - **pointerë¥¼ 3wordë¡œ ëŠ˜ë ¤ë²„ë¦¼ = {pointer, base, bound}**
        - ì´ë ‡ê²Œ í–ˆì„ ë•Œì˜ ë¬¸ì œëŠ”? í˜¸í™˜ì„±(compatibility) ì´ìŠˆ ë•Œë¬¸ì— ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì•ˆ ëŒì•„ê°ˆ ìˆ˜ ìˆë‹¤ 
            > â—† ì¼ë°˜ í¬ì¸í„°ëŠ” 8byteì¸ë°, Fat pointerëŠ” 24byteê°€ ë˜ë‹ˆê¹Œ, alignmentê°€ ë‹¤ ê¹¨ì ¸ì„œ í˜¸í™˜ì´ ì•ˆë¨

- **Softbound (PLDI 09)**
    - Creation(í• ë‹¹): Record base and bound upon allocations
    - Propagation: Copy the metadata when pointers are copied
    - Check ì—°ì‚°: When used, check if it is within [ğ‘ğ‘ğ‘ ğ‘’,ğ‘ğ‘ğ‘ ğ‘’ + ğ‘ğ‘œğ‘¢ğ‘›ğ‘‘]
    - Deallocation: free the metadata.
    ![Softbound](\assets\img\paper\Softbound code.png)
    _Softbound - Creation, Propagation, Check_



### Takeaways

- Red zone-based approaches are practical.
    - Not too expensive.
    - Catches most of violations.
- bounds checking approaches are more secure.
    - Becoming more efficient, but not yet.
- Latest hardware (CPUs) are adopting features for these.
    - Though may not be more efficient



---------------------------------------------------

## 4ì£¼ì°¨: Temporal Memory Safety

### Temporal Memory Violation

> **[1] Pointer Invalidation [2] Delayed Reuse [3] Garbage Collection [4] Type-Safe Memory Reuse [5] Lock-and-Key**

- ì œí•œëœ ë©”ëª¨ë¦¬ë¥¼ ìš´ì˜í•´ì•¼ í•˜ë¯€ë¡œ free & reclaimì„ í•´ì•¼í•˜ëŠ”ë°, ì´ë•Œ Temporal Memory Violationì´ ë°œìƒí•¨
    - **UAF, Uninitialized Free, Double free ë“±**

- **Use-after-free Example** â—†ì½”ë“œ ì²´í¬í•˜ê¸°
    - X->Nextê°€ free ë˜ë©´ì„œ ì´ ì²­í¬ê°€ heap allocatorì˜ free-listì— ë“¤ì–´ê°”ëŠ”ë°, 
        - ë‹¤ìŒë²ˆ makeListì—ì„œ ì´ ì²­í¬ê°€ ê·¸ëŒ€ë¡œ ì¬ì‚¬ìš©ë˜ë©´ì„œ,
        - freeëœ ì¤„ ì•Œì•˜ë˜ X->Next (dangling pointer)ê°€ ì¬ì‚¬ìš©ë˜ê²Œ ë¨ (=Use-After-Reallocation)
    - ë¬¸ì œ: dangling pointerê°€ ë§Œë“¤ì–´ì§„ ê²ƒ & í•´ë‹¹ ì²­í¬ì— ì¬í• ë‹¹ì´ ëœ ê²ƒ & ê·¸ê±¸ë¡œ ì ‘ê·¼ì„ ì‹œë„í•œ ê²ƒ

- ì—„ë°€íˆ ë§í•˜ë©´, Freeëœ ì˜ì—­ì„ dangling pointerê°€ ê°€ë¦¬í‚¤ê³ , ê·¸ê±¸ ì ‘ê·¼í•˜ëŠ” ê²ƒ = UAF
 

### [1] Pointer Invalidation

- **ê°ì²´ê°€ í•´ì œë˜ë©´ freeëœ ê°ì²´(ì²­í¬)ë¥¼ ê°€ë¦¬í‚¤ëŠ” ëª¨ë“  pointerë“¤ì— null ë„£ê¸°**
    - ë¬¸ì œì : ì²­í¬(object)ë§ˆë‹¤ ì´ ì²­í¬ë¥¼ ê°€ë¦¬í‚¤ëŠ” pointerë“¤ì˜ ìœ„ì¹˜ë¥¼ ì•Œê³  ìˆì–´ì•¼ í•¨

- **DangNull[NDSSâ€™15], FreeSentry[NDSSâ€™15]**
    - Red-black Tree ì´ìš©í•´ì„œ in pointer list, out pointer list ê´€ë¦¬

- **DangSan[Eurosysâ€™17]**
    - ìœ„ì˜ ìë£Œêµ¬ì¡°ëŠ” multi-core í™˜ê²½ì—ì„œ íš¨ìœ¨ì ì´ì§€ ëª» í•˜ë‹¤ (red-black treeê°€ ëª¨ë‘ critical sectionìœ¼ë¡œ ë¬¶ì¸ë‹¤)
        - ì½”ì–´(thread)ë§ˆë‹¤ ë³„ë„ì˜ ìë£Œêµ¬ì¡°ë¥¼ í• ë‹¹í•˜ì


### [2] Delayed Reuse

- freeëœ ë©”ëª¨ë¦¬ë¥¼ ì¬í• ë‹¹í•  ë•Œê¹Œì§€ì˜ ì‹œê°„ í…€ì„ ëŠ˜ë ¤ì„œ, ê³µê²©ìê°€ ì›í•˜ëŠ” íƒ€ì´ë°ì— ì¬í• ë‹¹ë˜ì§€ ì•Šë„ë¡ í•˜ì.
    - heap sprayingì²˜ëŸ¼ ë”ë¯¸ allocationì„ ê³„ì† í• ë‹¹í•˜ë‹¤ë³´ë©´ ëš«ë¦¼

- DieHarder[CCSâ€™10], FreeGuard[CCSâ€™17]
- Address sanitizer[ATCâ€™12]ì€ shadow memory...
    - UAF ì‹œì ì„ íƒì§€ ê°€ëŠ¥í•¨ â—† ???ë­ ì–´ë–»ê²Œ í•œë‹¤ê³ ???


### [3] Garbage Collection

- í•´ë‹¹ ì²­í¬ë¥¼ ê°€ë¦¬í‚¤ëŠ” dangling pointerê°€ ìˆìœ¼ë©´ ì²­í¬ë¥¼ ì¬í• ë‹¹í•˜ì§€ ë§ì.
    - ì²­í¬ë‹¹ ê°€ë¦¬í‚¤ëŠ” pointerë¥¼ íŠ¸ë˜í‚¹í•˜ê¸°
    - GCë°©ì‹ìœ¼ë¡œ ë©”ëª¨ë¦¬ ìŠ¤ìº”í•˜ê¸°
- CRCount[NDSSâ€™19], MarkUs[S&Pâ€™20]



### [4] Type-Safe Memory Reuse

- Use-After-Reallocationì„ í•˜ë”ë¼ë„ ì‚¬ìš©ì„±?ì„ ë–¨ì–´ëœ¨ë¦¬ê¸° ìœ„í•œ ë°©ë²•
- ë©”ëª¨ë¦¬ ì£¼ì†Œë³„ë¡œ í• ë‹¹ ê°€ëŠ¥í•œ object typeì„ ì§€ì •í•´ë‘ 


### [5] Lock-and-Key

- pointerë§ˆë‹¤ keyê°€ ìˆê³ , ì²­í¬ë§ˆë‹¤ lockì´ ìˆìŒ
- Free, Reallocation ë‘˜ ë‹¤ ë§‰ì„ ìˆ˜ ìˆëŠ” ë°©ë²• â—† ??ì–´ë–»ê²Œ??
-  CETS [ISMMâ€™10]
    - per pointer metadataë¡œ key-lock êµ¬í˜„
- í•œê³„: â—† 


### Spatial and Temporal Safety (ë™ì‹œì— ë°©ì–´)

- Watchdoglite[CGOâ€™14] â—† ???
    - Metadata for Spatial: object base, object bound
    - Metadata for Temporal: key, lock

-  BOGO[ASPLOSâ€™19]
    - bound table ë‘ê³  INV ë„£ê¸°
    - use-after-reallocationì€ ëª»ë§‰ìŒ



---------------------------------------------------
